"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.processIndex = void 0;
const fieldUtils_1 = require("./fieldUtils");
exports.processIndex = (model) => {
    const indexMap = model.fields.reduce((acc, field) => {
        const indexDirective = fieldUtils_1.getDirective(field)('index');
        if (!indexDirective) {
            return acc;
        }
        return { ...acc, [field.name]: indexDirective };
    }, {});
    const keyList = Object.entries(indexMap).map(([fieldName, directive]) => {
        var _a;
        return ({
            name: 'key',
            arguments: {
                name: directive.arguments.name,
                fields: [fieldName].concat((_a = directive.arguments.sortKeyFields) !== null && _a !== void 0 ? _a : []),
            },
        });
    });
    const existingIndexNames = model.directives
        .filter(directive => directive.name === 'key' && !!directive.arguments.name)
        .map(directive => directive.arguments.name);
    const deDupedKeyList = keyList.filter(key => !existingIndexNames.includes(key.arguments.name));
    model.directives.push(...deDupedKeyList);
};
//# sourceMappingURL=process-index.js.map