{"version":3,"file":"remove.js","sourceRoot":"","sources":["../../../src/commands/auth/remove.ts"],"names":[],"mappings":";;;AAAa,QAAA,IAAI,GAAG,QAAQ,CAAC;AAC7B,MAAM,QAAQ,GAAG,MAAM,CAAC;AACxB,uDAAqF;AACrF,qDAA0C;AAC1C,2FAAqF;AACrF,kHAA6G;AAEtG,MAAM,GAAG,GAAG,KAAK,EAAE,OAAmB,EAAE,EAAE;IAC/C,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,OAAO,CAAC;IACxC,MAAM,YAAY,GAAG,UAAU,CAAC,KAAK,CAAC;IACtC,MAAM,IAAI,GAAG,+BAAY,CAAC,OAAO,EAAE,CAAC;IACpC,MAAM,kBAAkB,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;QACpD,OAAO,CAAC,WAAW,EAAE,KAAK,EAAE,SAAS,EAAE,UAAU,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;IACpG,CAAC,CAAC,CAAC;IACH,IAAI,kBAAkB,EAAE;QACtB,yBAAO,CAAC,IAAI,CAAC,sBAAQ,CAAC,kBAAkB,CAAC,CAAC;KAC3C;IACD,MAAM,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE;QACnE,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,OAAO,KAAK,0CAAuB,CAAC,OAAO,CAAC;IAC5E,CAAC,CAAC,CAAC;IAEH,IAAI;QACF,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC;QAC/E,IAAI,CAAA,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,OAAO,MAAK,0CAAuB,CAAC,qBAAqB,EAAE;YAEvE,MAAM,QAAQ,GAAG,IAAI,iCAAc,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC;YACzD,MAAM,eAAe,GAAG,QAAQ,CAAC,kBAAkB,EAAE,CAAC;YACtD,eAAe,CAAC,aAAa,CAAC,iBAAiB,GAAG,EAAE,CAAC;YACrD,QAAQ,CAAC,mBAAmB,CAAC,eAAe,CAAC,CAAC;SAC/C;KACF;IAAC,OAAO,GAAG,EAAE;QACZ,yBAAO,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACxB,yBAAO,CAAC,KAAK,CAAC,+CAA+C,CAAC,CAAC;QAC/D,OAAO,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QACjC,OAAO,CAAC,QAAQ,GAAG,CAAC,CAAC;KACtB;AACH,CAAC,CAAC;AA7BW,QAAA,GAAG,OA6Bd","sourcesContent":["export const name = 'remove';\nconst category = 'auth';\nimport { $TSContext, AmplifySupportedService, stateManager } from 'amplify-cli-core';\nimport { printer } from 'amplify-prompts';\nimport { messages } from '../../provider-utils/awscloudformation/assets/string-maps';\nimport { AuthInputState } from '../../provider-utils/awscloudformation/auth-inputs-manager/auth-input-state';\n\nexport const run = async (context: $TSContext) => {\n  const { amplify, parameters } = context;\n  const resourceName = parameters.first;\n  const meta = stateManager.getMeta();\n  const dependentResources = Object.keys(meta).some(e => {\n    return ['analytics', 'api', 'storage', 'function'].includes(e) && Object.keys(meta[e]).length > 0;\n  });\n  if (dependentResources) {\n    printer.info(messages.dependenciesExists);\n  }\n  const authResourceName = Object.keys(meta.auth).filter(resourceKey => {\n    return meta.auth[resourceKey].service === AmplifySupportedService.COGNITO;\n  });\n\n  try {\n    const resource = await amplify.removeResource(context, category, resourceName);\n    if (resource?.service === AmplifySupportedService.COGNITOUSERPOOLGROUPS) {\n      // update cli input here\n      const cliState = new AuthInputState(authResourceName[0]);\n      const cliInputPayload = cliState.getCLIInputPayload();\n      cliInputPayload.cognitoConfig.userPoolGroupList = [];\n      cliState.saveCLIInputPayload(cliInputPayload);\n    }\n  } catch (err) {\n    printer.info(err.stack);\n    printer.error('There was an error removing the auth resource');\n    context.usageData.emitError(err);\n    process.exitCode = 1;\n  }\n};\n"]}